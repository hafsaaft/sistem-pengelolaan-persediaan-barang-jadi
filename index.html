<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartInventory ID - Sistem Stok Barang Jadi</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map to handle module imports -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@google/genai": "https://esm.sh/@google/genai@0.1.1",
    "recharts": "https://esm.sh/recharts@2.12.0?external=react,react-dom",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.556.0"
  }
}
</script>

    <!-- Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">
    
    <!-- Root Element -->
    <div id="root"></div>

    <!-- Application Logic -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { GoogleGenAI } from '@google/genai';
        import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell } from 'recharts';

        // --- ICONS (Inline SVGs to avoid dependency issues) ---
        const Icons = {
            Database: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
            LayoutDashboard: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>,
            ListPlus: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 12H3"/><path d="M16 6H3"/><path d="M16 18H3"/><path d="M18 9v6"/><path d="M21 12h-6"/></svg>,
            FileText: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>,
            Settings: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            DollarSign: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            Package: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22v-9"/></svg>,
            AlertTriangle: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>,
            TrendingUp: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
            PlusCircle: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>,
            MinusCircle: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></svg>,
            Download: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Sparkles: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 7h4"/><path d="M3 3h4"/></svg>,
            RefreshCw: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>,
            AlertCircle: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            CheckCircle: ({size=24, className=""}) => <svg width={size} height={size} className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
        };

        // --- TYPES & CONSTANTS ---
        const TransactionType = {
            IN: 'MASUK',
            OUT: 'KELUAR'
        };

        const ValuationMethod = {
            FIFO: 'FIFO',
            LIFO: 'LIFO',
            AVERAGE: 'AVERAGE'
        };

        // --- SERVICES: INVENTORY LOGIC ---
        const calculateAverage = (transactions) => {
            let totalQty = 0;
            let totalValue = 0;
            const sortedTx = [...transactions].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());

            for (const tx of sortedTx) {
                if (tx.type === TransactionType.IN) {
                    totalValue += tx.quantity * tx.pricePerUnit;
                    totalQty += tx.quantity;
                } else {
                    if (totalQty > 0) {
                        const avgCost = totalValue / totalQty;
                        totalValue -= tx.quantity * avgCost;
                        totalQty -= tx.quantity;
                    }
                }
            }
            return { quantity: Math.max(0, totalQty), value: Math.max(0, totalValue) };
        };

        const calculateFIFO = (transactions) => {
            const batches = [];
            const sortedTx = [...transactions].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());

            for (const tx of sortedTx) {
                if (tx.type === TransactionType.IN) {
                    batches.push({ quantity: tx.quantity, cost: tx.pricePerUnit });
                } else {
                    let qtyToRemove = tx.quantity;
                    while (qtyToRemove > 0 && batches.length > 0) {
                        const currentBatch = batches[0];
                        if (currentBatch.quantity > qtyToRemove) {
                            currentBatch.quantity -= qtyToRemove;
                            qtyToRemove = 0;
                        } else {
                            qtyToRemove -= currentBatch.quantity;
                            batches.shift();
                        }
                    }
                }
            }
            const totalValue = batches.reduce((sum, b) => sum + (b.quantity * b.cost), 0);
            const totalQty = batches.reduce((sum, b) => sum + b.quantity, 0);
            return { quantity: totalQty, value: totalValue };
        };

        const calculateLIFO = (transactions) => {
            const batches = [];
            const sortedTx = [...transactions].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());

            for (const tx of sortedTx) {
                if (tx.type === TransactionType.IN) {
                    batches.push({ quantity: tx.quantity, cost: tx.pricePerUnit });
                } else {
                    let qtyToRemove = tx.quantity;
                    while (qtyToRemove > 0 && batches.length > 0) {
                        const currentBatch = batches[batches.length - 1];
                        if (currentBatch.quantity > qtyToRemove) {
                            currentBatch.quantity -= qtyToRemove;
                            qtyToRemove = 0;
                        } else {
                            qtyToRemove -= currentBatch.quantity;
                            batches.pop();
                        }
                    }
                }
            }
            const totalValue = batches.reduce((sum, b) => sum + (b.quantity * b.cost), 0);
            const totalQty = batches.reduce((sum, b) => sum + b.quantity, 0);
            return { quantity: totalQty, value: totalValue };
        };

        const generateValuationReport = (products, transactions, method) => {
            return products.map((product) => {
                const productTx = transactions.filter((t) => t.productId === product.id);
                let result = { quantity: 0, value: 0 };

                switch (method) {
                    case ValuationMethod.FIFO: result = calculateFIFO(productTx); break;
                    case ValuationMethod.LIFO: result = calculateLIFO(productTx); break;
                    case ValuationMethod.AVERAGE: result = calculateAverage(productTx); break;
                    default: result = calculateAverage(productTx);
                }

                return {
                    productId: product.id,
                    productName: product.name,
                    quantityOnHand: result.quantity,
                    totalValue: result.value,
                    unitValue: result.quantity > 0 ? result.value / result.quantity : 0,
                    method: method,
                };
            });
        };

        // --- SERVICES: GEMINI AI ---
        // Safely access env var or default to empty string
        const API_KEY = (typeof process !== 'undefined' && process.env && process.env.API_KEY) ? process.env.API_KEY : '';
        const aiClient = new GoogleGenAI({ apiKey: API_KEY });

        const analyzeInventory = async (products, transactions, valuationReport) => {
            if (!API_KEY) {
                 throw new Error("API Key tidak ditemukan. Pastikan process.env.API_KEY dikonfigurasi.");
            }

            const context = {
                products: products.map(p => ({ name: p.name, minStock: p.minStock })),
                valuationSummary: valuationReport.map(v => ({
                    product: v.productName,
                    qty: v.quantityOnHand,
                    totalValue: v.totalValue,
                    method: v.method
                })),
                recentTransactionsCount: transactions.length,
                date: new Date().toISOString()
            };

            const prompt = `
                Anda adalah analis Supply Chain senior. Analisis data persediaan berikut dalam format JSON.
                Data: ${JSON.stringify(context)}

                Tugas:
                1. Berikan ringkasan kondisi stok.
                2. Identifikasi potensi Dead Stock atau Overstock.
                3. Identifikasi risiko Stockout (barang hampir habis di bawah minStock).
                4. Berikan rekomendasi spesifik.

                Output MURNI JSON tanpa markdown code block.
            `;

            try {
                const response = await aiClient.models.generateContent({
                    model: 'gemini-2.5-flash',
                    contents: prompt,
                    config: {
                        responseMimeType: 'application/json'
                    }
                });
                
                // Handle potential JSON markdown wrapping
                let text = response.text;
                if (text.startsWith('```json')) {
                    text = text.replace(/^```json/, '').replace(/```$/, '');
                }
                return JSON.parse(text);
            } catch (error) {
                console.error("Gemini Error:", error);
                throw error;
            }
        };

        // --- COMPONENTS ---

        const Dashboard = ({ products, transactions }) => {
            const report = useMemo(() => 
                generateValuationReport(products, transactions, ValuationMethod.AVERAGE), 
            [products, transactions]);

            const totalValue = report.reduce((sum, item) => sum + item.totalValue, 0);
            const totalItems = report.reduce((sum, item) => sum + item.quantityOnHand, 0);
            
            const lowStockItems = report.filter(item => {
                const prod = products.find(p => p.id === item.productId);
                return prod && item.quantityOnHand <= prod.minStock;
            });

            const chartData = report.map(item => ({
                name: item.productName,
                value: item.totalValue,
                qty: item.quantityOnHand
            })).sort((a, b) => b.value - a.value).slice(0, 10);

            return (
                <div className="space-y-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-center space-x-4">
                            <div className="p-3 bg-emerald-100 text-emerald-600 rounded-lg"><Icons.DollarSign /></div>
                            <div>
                                <p className="text-sm text-slate-500 font-medium">Nilai Persediaan (Avg)</p>
                                <h3 className="text-2xl font-bold text-slate-800">Rp {totalValue.toLocaleString('id-ID', { maximumFractionDigits: 0 })}</h3>
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-center space-x-4">
                            <div className="p-3 bg-blue-100 text-blue-600 rounded-lg"><Icons.Package /></div>
                            <div>
                                <p className="text-sm text-slate-500 font-medium">Total Item Fisik</p>
                                <h3 className="text-2xl font-bold text-slate-800">{totalItems} Unit</h3>
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-center space-x-4">
                            <div className="p-3 bg-amber-100 text-amber-600 rounded-lg"><Icons.AlertTriangle /></div>
                            <div>
                                <p className="text-sm text-slate-500 font-medium">Stok Menipis</p>
                                <h3 className="text-2xl font-bold text-slate-800">{lowStockItems.length} SKU</h3>
                            </div>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex items-center space-x-4">
                            <div className="p-3 bg-purple-100 text-purple-600 rounded-lg"><Icons.TrendingUp /></div>
                            <div>
                                <p className="text-sm text-slate-500 font-medium">Total Transaksi</p>
                                <h3 className="text-2xl font-bold text-slate-800">{transactions.length}</h3>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <h3 className="text-lg font-semibold mb-4 text-slate-800">Top 10 Aset Barang (Nilai Rupiah)</h3>
                            <div className="h-64 w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={chartData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                        <XAxis dataKey="name" tick={{fontSize: 12}} interval={0} angle={-15} textAnchor="end" />
                                        <YAxis tickFormatter={(value) => `${value / 1000000}jt`} />
                                        <Tooltip formatter={(value) => `Rp ${value.toLocaleString('id-ID')}`} />
                                        <Bar dataKey="value" radius={[4, 4, 0, 0]}>
                                            {chartData.map((entry, index) => (
                                                <Cell key={`cell-${index}`} fill={index % 2 === 0 ? '#3b82f6' : '#6366f1'} />
                                            ))}
                                        </Bar>
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <h3 className="text-lg font-semibold mb-4 text-slate-800">Perlu Perhatian (Low Stock)</h3>
                            <div className="space-y-4 overflow-y-auto max-h-64 pr-2">
                                {lowStockItems.length === 0 ? (
                                    <p className="text-slate-400 text-sm italic">Semua stok aman.</p>
                                ) : (
                                    lowStockItems.map(item => (
                                        <div key={item.productId} className="flex justify-between items-center p-3 bg-red-50 rounded-lg border border-red-100">
                                            <div>
                                                <p className="font-medium text-slate-800">{item.productName}</p>
                                                <p className="text-xs text-red-600">Sisa: {item.quantityOnHand} Unit</p>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const TransactionForm = ({ products, onSubmit }) => {
            const [type, setType] = useState(TransactionType.IN);
            const [productId, setProductId] = useState('');
            const [quantity, setQuantity] = useState(0);
            const [price, setPrice] = useState(0);
            const [reference, setReference] = useState('');
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!productId || quantity <= 0) return;
                onSubmit({ productId, type, quantity, price, reference, date });
                setQuantity(0);
                setReference('');
            };

            return (
                <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                    <h2 className="text-lg font-semibold mb-6 text-slate-800 flex items-center gap-2">
                        {type === TransactionType.IN ? <Icons.PlusCircle className="text-emerald-500" /> : <Icons.MinusCircle className="text-red-500" />}
                        Catat Transaksi
                    </h2>
                    
                    <div className="flex gap-4 mb-6">
                        <button onClick={() => setType(TransactionType.IN)} className={`flex-1 py-2 rounded-lg font-medium transition-colors ${type === TransactionType.IN ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>Barang Masuk</button>
                        <button onClick={() => setType(TransactionType.OUT)} className={`flex-1 py-2 rounded-lg font-medium transition-colors ${type === TransactionType.OUT ? 'bg-red-500 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>Barang Keluar</button>
                    </div>

                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Tanggal</label>
                                <input type="date" required value={date} onChange={(e) => setDate(e.target.value)} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Produk</label>
                                <select required value={productId} onChange={(e) => setProductId(e.target.value)} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                                    <option value="">Pilih Produk...</option>
                                    {products.map(p => (<option key={p.id} value={p.id}>{p.sku} - {p.name}</option>))}
                                </select>
                            </div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">Jumlah</label>
                                <input type="number" min="1" required value={quantity || ''} onChange={(e) => setQuantity(Number(e.target.value))} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="0" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-slate-700 mb-1">{type === TransactionType.IN ? 'Biaya Produksi / Unit' : 'Harga Jual / Unit'}</label>
                                <input type="number" min="0" value={price || ''} onChange={(e) => setPrice(Number(e.target.value))} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Rp 0" />
                            </div>
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-slate-700 mb-1">Referensi (No. Batch / Order)</label>
                            <input type="text" value={reference} onChange={(e) => setReference(e.target.value)} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Contoh: PO-2023-001" />
                        </div>
                        <button type="submit" className="w-full py-2.5 bg-slate-800 text-white rounded-lg font-medium hover:bg-slate-900 transition-colors">Simpan Transaksi</button>
                    </form>
                </div>
            );
        };

        const InventoryReport = ({ products, transactions }) => {
            const [method, setMethod] = useState(ValuationMethod.AVERAGE);
            const report = generateValuationReport(products, transactions, method);
            const totalValue = report.reduce((sum, item) => sum + item.totalValue, 0);

            return (
                <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                    <div className="p-6 border-b border-slate-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div>
                            <h2 className="text-lg font-semibold text-slate-800">Laporan Valuasi Persediaan</h2>
                            <p className="text-sm text-slate-500">Hitung nilai aset berdasarkan metode akuntansi.</p>
                        </div>
                        <div className="flex items-center gap-3">
                            <select value={method} onChange={(e) => setMethod(e.target.value)} className="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm font-medium focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value={ValuationMethod.FIFO}>FIFO</option>
                                <option value={ValuationMethod.LIFO}>LIFO</option>
                                <option value={ValuationMethod.AVERAGE}>Average</option>
                            </select>
                            <button className="p-2 text-slate-600 hover:bg-slate-100 rounded-lg border border-slate-200"><Icons.Download size={20} /></button>
                        </div>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm text-left">
                            <thead className="bg-slate-50 text-slate-500 font-medium border-b border-slate-100">
                                <tr>
                                    <th className="px-6 py-3">Produk</th>
                                    <th className="px-6 py-3 text-right">Qty Akhir</th>
                                    <th className="px-6 py-3 text-right">Nilai Satuan ({method})</th>
                                    <th className="px-6 py-3 text-right">Total Nilai</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100">
                                {report.map((item) => (
                                    <tr key={item.productId} className="hover:bg-slate-50 transition-colors">
                                        <td className="px-6 py-3 font-medium text-slate-800">{item.productName}</td>
                                        <td className="px-6 py-3 text-right">{item.quantityOnHand}</td>
                                        <td className="px-6 py-3 text-right text-slate-600">Rp {item.unitValue.toLocaleString('id-ID', { maximumFractionDigits: 0 })}</td>
                                        <td className="px-6 py-3 text-right font-semibold text-slate-800">Rp {item.totalValue.toLocaleString('id-ID', { maximumFractionDigits: 0 })}</td>
                                    </tr>
                                ))}
                            </tbody>
                            <tfoot className="bg-slate-50 font-semibold text-slate-800">
                                <tr>
                                    <td colSpan={3} className="px-6 py-3 text-right">Total Aset Barang Jadi</td>
                                    <td className="px-6 py-3 text-right">Rp {totalValue.toLocaleString('id-ID', { maximumFractionDigits: 0 })}</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            );
        };

        const AIAdvisor = ({ products, transactions }) => {
            const [loading, setLoading] = useState(false);
            const [analysis, setAnalysis] = useState(null);
            const [error, setError] = useState(null);

            const handleAnalyze = async () => {
                setLoading(true);
                setError(null);
                try {
                    const report = generateValuationReport(products, transactions, ValuationMethod.AVERAGE);
                    const result = await analyzeInventory(products, transactions, report);
                    setAnalysis(result);
                } catch (err) {
                    setError(err.message || "Gagal menghubungi AI Assistant.");
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="bg-gradient-to-br from-indigo-50 to-purple-50 p-6 rounded-xl border border-indigo-100">
                    <div className="flex justify-between items-center mb-6">
                        <div className="flex items-center gap-2">
                            <div className="bg-indigo-600 p-2 rounded-lg text-white shadow-lg shadow-indigo-200"><Icons.Sparkles size={20} /></div>
                            <div>
                                <h2 className="text-lg font-bold text-indigo-900">AI Inventory Analyst</h2>
                                <p className="text-xs text-indigo-600">Didukung oleh Gemini 2.5 Flash</p>
                            </div>
                        </div>
                        <button onClick={handleAnalyze} disabled={loading} className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition-all shadow-md">
                            {loading ? <Icons.RefreshCw className="animate-spin" size={16} /> : <Icons.Sparkles size={16} />}
                            {loading ? 'Menganalisis...' : 'Analisis Stok'}
                        </button>
                    </div>

                    {error && (
                        <div className="p-4 bg-red-100 text-red-700 rounded-lg flex items-center gap-2 mb-4">
                            <Icons.AlertCircle size={18} /> {error}
                        </div>
                    )}

                    {analysis && !loading && (
                        <div className="space-y-4 animate-fade-in">
                            <div className="bg-white/80 backdrop-blur-sm p-4 rounded-lg border border-indigo-100">
                                <h3 className="font-semibold text-indigo-900 mb-2">Ringkasan Eksekutif</h3>
                                <p className="text-slate-700 text-sm leading-relaxed">{analysis.summary}</p>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="bg-white/80 backdrop-blur-sm p-4 rounded-lg border border-red-100">
                                    <h3 className="font-semibold text-red-800 mb-2 flex items-center gap-2"><Icons.AlertCircle size={16} /> Risiko & Isu</h3>
                                    <p className="text-slate-700 text-sm">{analysis.riskAssessment}</p>
                                </div>
                                <div className="bg-white/80 backdrop-blur-sm p-4 rounded-lg border border-blue-100">
                                    <h3 className="font-semibold text-blue-800 mb-2 flex items-center gap-2"><Icons.RefreshCw size={16} /> Perputaran Stok</h3>
                                    <p className="text-slate-700 text-sm">{analysis.turnoverAnalysis}</p>
                                </div>
                            </div>
                            <div className="bg-white/80 backdrop-blur-sm p-4 rounded-lg border border-emerald-100">
                                <h3 className="font-semibold text-emerald-800 mb-3 flex items-center gap-2"><Icons.CheckCircle size={16} /> Rekomendasi Tindakan</h3>
                                <ul className="space-y-2">
                                    {analysis.recommendations?.map((rec, idx) => (
                                        <li key={idx} className="flex gap-2 text-sm text-slate-700"><span className="text-emerald-500 font-bold">•</span>{rec}</li>
                                    ))}
                                </ul>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [products] = useState([
                { id: 'p1', sku: 'FG-001', name: 'Meja Kantor Kayu Jati', minStock: 5, category: 'Furniture' },
                { id: 'p2', sku: 'FG-002', name: 'Kursi Ergonomis A1', minStock: 10, category: 'Furniture' },
                { id: 'p3', sku: 'EL-101', name: 'Lampu Belajar LED', minStock: 20, category: 'Elektronik' },
            ]);
            const [transactions, setTransactions] = useState([
                { id: 't1', productId: 'p1', type: TransactionType.IN, quantity: 10, pricePerUnit: 1500000, date: '2023-10-01', reference: 'BATCH-001' },
                { id: 't2', productId: 'p1', type: TransactionType.IN, quantity: 5, pricePerUnit: 1600000, date: '2023-10-15', reference: 'BATCH-002' },
                { id: 't3', productId: 'p2', type: TransactionType.IN, quantity: 20, pricePerUnit: 750000, date: '2023-10-05', reference: 'BATCH-001' },
                { id: 't4', productId: 'p1', type: TransactionType.OUT, quantity: 3, pricePerUnit: 2500000, date: '2023-10-20', reference: 'INV-1001' },
            ]);

            const handleAddTransaction = (data) => {
                const newTx = {
                    id: `t${Date.now()}`,
                    productId: data.productId,
                    type: data.type,
                    quantity: data.quantity,
                    pricePerUnit: data.price,
                    reference: data.reference,
                    date: data.date
                };
                setTransactions(prev => [...prev, newTx]);
                alert("Transaksi berhasil disimpan!");
            };

            return (
                <div className="min-h-screen flex bg-slate-50 font-sans">
                    <aside className="w-64 bg-slate-900 text-white hidden md:flex flex-col fixed h-full z-10">
                        <div className="p-6 border-b border-slate-800">
                            <h1 className="text-xl font-bold flex items-center gap-2">
                                <Icons.Database className="text-emerald-400" />
                                Smart<span className="text-emerald-400">Inventory</span>
                            </h1>
                            <p className="text-xs text-slate-400 mt-1">Managed Inventory System</p>
                        </div>
                        <nav className="flex-1 p-4 space-y-2">
                            <button onClick={() => setActiveTab('dashboard')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${activeTab === 'dashboard' ? 'bg-emerald-600 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <Icons.LayoutDashboard size={20} /> Dashboard
                            </button>
                            <button onClick={() => setActiveTab('transactions')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${activeTab === 'transactions' ? 'bg-emerald-600 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <Icons.ListPlus size={20} /> Transaksi (In/Out)
                            </button>
                            <button onClick={() => setActiveTab('report')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${activeTab === 'report' ? 'bg-emerald-600 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}>
                                <Icons.FileText size={20} /> Laporan & Valuasi
                            </button>
                            <button onClick={() => setActiveTab('ai')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors ${activeTab === 'ai' ? 'bg-indigo-600 text-white' : 'text-indigo-300 hover:bg-indigo-900/50 hover:text-white'}`}>
                                <Icons.Settings size={20} /> AI Analysis
                            </button>
                        </nav>
                        <div className="p-4 border-t border-slate-800 text-xs text-slate-500">&copy; 2024 SmartInventory ID</div>
                    </aside>

                    <div className="md:hidden fixed top-0 w-full bg-slate-900 text-white z-20 p-4 flex justify-between items-center shadow-md">
                        <h1 className="font-bold flex items-center gap-2"><Icons.Database size={18} /> SmartInventory</h1>
                        <div className="flex gap-4">
                            <Icons.LayoutDashboard onClick={() => setActiveTab('dashboard')} />
                            <Icons.ListPlus onClick={() => setActiveTab('transactions')} />
                            <Icons.FileText onClick={() => setActiveTab('report')} />
                        </div>
                    </div>

                    <main className="flex-1 md:ml-64 p-6 md:p-8 mt-14 md:mt-0 overflow-y-auto">
                        <header className="mb-8">
                            <h2 className="text-2xl font-bold text-slate-800">
                                {activeTab === 'dashboard' && 'Dashboard Overview'}
                                {activeTab === 'transactions' && 'Pencatatan Transaksi'}
                                {activeTab === 'report' && 'Laporan Valuasi Stok'}
                                {activeTab === 'ai' && 'Analisis Cerdas (AI)'}
                            </h2>
                            <p className="text-slate-500 text-sm">
                                {activeTab === 'dashboard' && 'Ringkasan performa dan nilai aset persediaan saat ini.'}
                                {activeTab === 'transactions' && 'Catat hasil produksi (Masuk) atau pengiriman barang (Keluar).'}
                                {activeTab === 'report' && 'Analisis nilai barang menggunakan metode FIFO, LIFO, atau Average.'}
                                {activeTab === 'ai' && 'Dapatkan rekomendasi otomatis untuk efisiensi gudang.'}
                            </p>
                        </header>

                        <div className="max-w-7xl mx-auto space-y-6">
                            {activeTab === 'dashboard' && (
                                <React.Fragment>
                                    <Dashboard products={products} transactions={transactions} />
                                    <AIAdvisor products={products} transactions={transactions} />
                                </React.Fragment>
                            )}
                            {activeTab === 'transactions' && (
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <TransactionForm products={products} onSubmit={handleAddTransaction} />
                                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                        <h3 className="font-semibold text-slate-800 mb-4">Riwayat Transaksi Terakhir</h3>
                                        <div className="space-y-3">
                                            {[...transactions].reverse().slice(0, 5).map(tx => (
                                                <div key={tx.id} className="flex justify-between items-center p-3 bg-slate-50 rounded-lg text-sm">
                                                    <div>
                                                        <div className="font-medium text-slate-800">{tx.type === TransactionType.IN ? 'MASUK' : 'KELUAR'} - {products.find(p => p.id === tx.productId)?.name}</div>
                                                        <div className="text-slate-500 text-xs">{tx.date} • Ref: {tx.reference}</div>
                                                    </div>
                                                    <div className={`font-bold ${tx.type === TransactionType.IN ? 'text-emerald-600' : 'text-red-600'}`}>{tx.type === TransactionType.IN ? '+' : '-'}{tx.quantity}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                            {activeTab === 'report' && <InventoryReport products={products} transactions={transactions} />}
                            {activeTab === 'ai' && <AIAdvisor products={products} transactions={transactions} />}
                        </div>
                    </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>